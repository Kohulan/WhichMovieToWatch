---
phase: 08-polish-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/layout/AppShell.tsx
  - src/components/layout/TabBar.tsx
  - src/components/layout/Navbar.tsx
  - src/components/discovery/DiscoveryPage.tsx
  - src/components/dinner-time/DinnerTimePage.tsx
  - src/components/free-movies/FreeMoviesPage.tsx
  - src/components/movie/MovieActions.tsx
  - src/components/movie/MovieHero.tsx
  - src/components/search/SpotlightSearch.tsx
  - src/styles/app.css
autonomous: true
requirements:
  - A11Y-01

must_haves:
  truths:
    - "All interactive elements are reachable via Tab key and operable via Enter/Space/Escape"
    - "Color contrast meets WCAG AA minimum (4.5:1 normal text, 3:1 large text) across all 6 theme variants"
    - "Skip navigation link jumps focus to #main-content when activated"
    - "Screen reader (VoiceOver) can navigate all page sections and announce dynamic content changes"
    - "Focus is properly managed: trapped in modals, returned on close, visible focus rings on all interactive elements"
  artifacts:
    - path: "src/styles/app.css"
      provides: "Color contrast fixes for clay-text-muted across all 6 theme variants"
      contains: "clay-text-muted"
    - path: "src/components/layout/AppShell.tsx"
      provides: "Skip link and landmark roles"
      contains: "main-content"
  key_links:
    - from: "src/components/layout/AppShell.tsx"
      to: "#main-content"
      via: "Skip navigation anchor href"
      pattern: "href.*main-content"
---

<objective>
Audit and fix WCAG 2.1 AA accessibility compliance across all components, focusing on color contrast, keyboard navigation, focus management, and ARIA semantics.

Purpose: Achieve WCAG 2.1 AA compliance (A11Y-01) — the codebase already has 148 ARIA attributes, skip link, and focus rings. This plan closes the remaining gaps: color contrast on muted text across all 6 theme variants, keyboard flow between sections, focus trapping in modals/overlays, and ARIA live region coverage for dynamic content.

Output: All pages keyboard-navigable, all text meets 4.5:1 contrast, dynamic content announced to screen readers, focus properly managed in modals/overlays.
</objective>

<execution_context>
@/Users/kohulanrajan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kohulanrajan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-polish-optimization/08-RESEARCH.md
@src/styles/app.css
@src/components/layout/AppShell.tsx
@src/components/layout/TabBar.tsx
@src/components/discovery/DiscoveryPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix color contrast and ARIA semantics across all theme variants</name>
  <files>
    src/styles/app.css
    src/components/layout/TabBar.tsx
    src/components/layout/Navbar.tsx
    src/components/movie/MovieHero.tsx
    src/components/movie/MovieActions.tsx
  </files>
  <action>
    Audit and fix color contrast for WCAG AA compliance (4.5:1 normal text, 3:1 large text) across all 6 theme variants (Cinema Gold/Ocean Blue/Neon Purple x light/dark).

    1. **Color contrast fixes in app.css:**
       - Increase `--clay-text-muted` lightness in ALL 6 theme blocks (`.theme-cinema-gold`, `.theme-ocean-blue`, `.theme-neon-purple` in both light and dark modes). The muted text on clay-surface is the highest-risk combination.
       - For dark modes: raise muted text lightness to at least 65% oklch (currently around 55-60%).
       - For light modes: lower muted text lightness to at most 40% oklch (ensure dark enough against light surface).
       - Verify `--clay-text` (primary text) also passes — it likely does but confirm.
       - Verify `--accent` color against `--clay-base` for each theme variant — accent buttons/links must pass 3:1 for large text.

    2. **ARIA landmark and role fixes:**
       - In TabBar.tsx: the footer already uses `<footer>` semantic element. Add `role="contentinfo"` for explicit landmark.
       - In Navbar.tsx: ensure `<nav>` has `aria-label="Main navigation"` for screen reader landmark identification.
       - In MovieHero.tsx: add `role="region"` and `aria-label="Movie details"` to the hero section wrapper.
       - In MovieActions.tsx: add `role="toolbar"` and `aria-label="Movie actions"` to the action button group div. Ensure each button has descriptive `aria-label` (e.g., "Love this movie", "Mark as watched", "Not interested", "Next movie").

    3. **Focus ring visibility:**
       - In app.css: verify the global `focus-visible` ring uses a high-contrast color. If it uses accent color, ensure it passes against all 6 backgrounds. Add `outline-offset: 2px` for spacing from element edge.
       - Add `focus-visible:ring-2 focus-visible:ring-accent` utility pattern if not already global.
  </action>
  <verify>
    - Use browser DevTools accessibility color contrast checker on each of the 6 theme variants (toggle themes in the app). Check `clay-text-muted` on `clay-surface`, `clay-text` on `clay-base`, `accent` on `clay-base`.
    - Run `npx tsc --noEmit` to verify no TypeScript errors introduced.
  </verify>
  <done>All text across all 6 theme variants meets WCAG AA 4.5:1 contrast for normal text and 3:1 for large text. ARIA landmarks (nav, main, contentinfo) are labeled. MovieActions has toolbar role with descriptive button labels.</done>
</task>

<task type="auto">
  <name>Task 2: Fix keyboard navigation flow and focus management</name>
  <files>
    src/components/layout/AppShell.tsx
    src/components/discovery/DiscoveryPage.tsx
    src/components/dinner-time/DinnerTimePage.tsx
    src/components/free-movies/FreeMoviesPage.tsx
    src/components/search/SpotlightSearch.tsx
  </files>
  <action>
    Ensure complete keyboard navigation flow and focus management for WCAG 2.1 AA.

    1. **Skip link verification in AppShell.tsx:**
       - The skip link already exists (href="#main-content"). Verify it has proper styling: `sr-only` by default, visible on focus with high-contrast background. It already has this — just confirm it works by tabbing from browser chrome into the page.
       - Ensure `tabIndex={-1}` is on the `#main-content` main element so focus scrolls correctly when the skip link is activated (some browsers need this for anchor-to-div navigation).

    2. **Focus management on route changes:**
       - In AppShell.tsx: after the route transition animation completes, set focus to `#main-content` using a ref. This ensures screen reader users know they've navigated. Use a `useEffect` on `location.pathname` that calls `mainRef.current?.focus()` with a short delay (100ms) to allow AnimatePresence to complete.
       - Add `tabIndex={-1}` to the `<motion.main>` element so it can receive programmatic focus without being in the tab order.

    3. **Modal focus trapping:**
       - In SpotlightSearch.tsx (SearchModal): verify focus is trapped inside the modal when open. On open, auto-focus the search input. On Escape, close the modal and return focus to the trigger element. If focus trapping is incomplete, add a `useEffect` that listens for Tab keydown and wraps focus between first and last focusable elements inside the modal.

    4. **Keyboard operability of movie actions:**
       - In DiscoveryPage.tsx, DinnerTimePage.tsx, FreeMoviesPage.tsx: ensure all interactive elements (buttons, links) are in logical tab order. The movie poster, action buttons, trailer link, and provider logos should all be reachable via Tab.
       - Ensure service selector buttons in DinnerTimePage are keyboard-operable (Enter/Space to select service).

    5. **ARIA live region for dynamic movie content:**
       - When a new movie loads in DiscoveryPage (after Next Movie, Love, Watched, Not Interested), ensure the movie title is announced to screen readers via the existing useAnnounce hook. If not already called, add `announce(\`Now showing: ${movie.title}\`)` after movie loads.
       - Same for DinnerTimePage when a new dinner movie loads.
       - Same for FreeMoviesPage when a new free movie loads.
  </action>
  <verify>
    - Tab through the entire app from top to bottom: Skip link -> Navbar -> Main content -> Movie actions -> Footer. Verify no focus traps or dead ends.
    - Open SearchModal via keyboard (Enter on search trigger), type a query, Tab through results, press Escape to close, verify focus returns.
    - Navigate between routes using Tab + Enter on TabBar links (or browser navigation), verify focus moves to main content.
    - Run `npx tsc --noEmit` to verify no TypeScript errors.
  </verify>
  <done>
    - Skip link moves focus to main content on activation
    - Route changes move focus to main content for screen reader awareness
    - SearchModal traps focus and returns focus on close
    - Movie title announced via ARIA live region when new movie loads on Discovery/DinnerTime/FreeMovies pages
    - All interactive elements reachable and operable via keyboard (Tab/Enter/Space/Escape)
  </done>
</task>

</tasks>

<verification>
1. Tab through every page (Home, Discover, Trending, Dinner Time, Free Movies) — all interactive elements reachable, no keyboard traps.
2. Activate skip link — focus moves to #main-content.
3. Open and close SearchModal via keyboard — focus trapped inside, returned on close.
4. Check color contrast on all 6 theme variants using browser DevTools.
5. VoiceOver test: navigate Discovery page, hear movie title, ratings, actions, providers announced correctly.
6. `npx tsc --noEmit` passes.
</verification>

<success_criteria>
- All text meets WCAG AA contrast ratios (4.5:1 normal, 3:1 large) across all 6 theme variants
- Keyboard navigation covers all interactive elements with no traps
- Screen reader users hear movie title announcements on content change
- Skip navigation link functional
- Focus management correct on route change and modal open/close
</success_criteria>

<output>
After completion, create `.planning/phases/08-polish-optimization/08-01-SUMMARY.md`
</output>
