---
phase: 08-polish-optimization
plan: 05
type: execute
wave: 3
depends_on:
  - "08-01"
  - "08-02"
  - "08-03"
  - "08-04"
files_modified:
  - .github/workflows/deploy.yml
  - index.html
autonomous: false
requirements:
  - PERF-03

must_haves:
  truths:
    - "GitHub Actions deployment workflow builds, injects API keys, and deploys to GitHub Pages on main branch push"
    - "Lighthouse CI runs as a non-blocking check in the deployment pipeline"
    - "Default OG/Twitter meta tags are set in index.html for the app homepage"
    - "Final production build completes without errors and bundle is under 500KB gzipped"
    - "Human checkpoint validates deliverables from 08-01 (A11Y-01), 08-03 (SOCL-01), 08-04 (SECU-01, PRIV-01, PRIV-02) end-to-end"
  artifacts:
    - path: ".github/workflows/deploy.yml"
      provides: "Deployment workflow with Lighthouse CI check"
      contains: "lighthouse"
    - path: "index.html"
      provides: "Default OG/Twitter meta tags for homepage"
      contains: "og:title"
  key_links:
    - from: ".github/workflows/deploy.yml"
      to: "dist/"
      via: "Vite build output uploaded to GitHub Pages"
      pattern: "npm run build"
---

<objective>
Add Lighthouse CI to deployment pipeline, set default OG meta tags in index.html, run final production build verification, and perform human visual/functional verification of all Phase 8 deliverables.

Purpose: Finalize the deployment pipeline and verify all Phase 8 requirements are met end-to-end. Lighthouse CI provides ongoing performance regression visibility. Default OG tags ensure the homepage has good social previews. The checkpoint confirms everything works visually and functionally.

Output: Updated deploy workflow with Lighthouse CI, default OG tags in index.html, verified production build, human-approved final state.
</objective>

<execution_context>
@/Users/kohulanrajan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kohulanrajan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-polish-optimization/08-RESEARCH.md
@.github/workflows/deploy.yml
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Lighthouse CI to deploy workflow and default OG meta tags</name>
  <files>
    .github/workflows/deploy.yml
    index.html
  </files>
  <action>
    Enhance the deployment pipeline and add default social meta tags.

    1. **Add Lighthouse CI step to `.github/workflows/deploy.yml`:**
       - Per Claude's discretion (research): Add Lighthouse CI as a **non-blocking check** (report only, no PR gate).
       - After the `npm run build` step and before `actions/configure-pages@v5`, add a single Lighthouse CI step:
         ```yaml
         - name: Lighthouse audit
           uses: treosh/lighthouse-ci-action@v12
           with:
             staticDistDir: dist
             uploadArtifacts: true
             temporaryPublicStorage: true
             runs: 1
           continue-on-error: true
         ```
       - **Key:** `staticDistDir: dist` tells the action to spin up its own local server from the `dist/` directory — no `file://` URLs, no external server, no `.lighthouserc.json` config file needed.
       - The `continue-on-error: true` makes it non-blocking — deployment proceeds even if Lighthouse scores are below thresholds.
       - Place this step AFTER `npm run build` and BEFORE `actions/configure-pages@v5`.

    2. **Add default OG/Twitter meta tags to `index.html`:**
       - These serve as fallback for crawlers that don't execute JavaScript (which is all of them for SPAs).
       - Add in `<head>`, after the existing `<meta name="description">` tag:
         ```html
         <!-- Open Graph -->
         <meta property="og:title" content="Which Movie To Watch - Find Your Next Movie" />
         <meta property="og:description" content="Discover your next favorite movie with a visually immersive experience that makes browsing feel as cinematic as watching." />
         <meta property="og:image" content="https://www.whichmovieto.watch/favicon_io/android-chrome-512x512.png" />
         <meta property="og:url" content="https://www.whichmovieto.watch/" />
         <meta property="og:type" content="website" />
         <meta property="og:site_name" content="Which Movie To Watch" />

         <!-- Twitter Card -->
         <meta name="twitter:card" content="summary_large_image" />
         <meta name="twitter:title" content="Which Movie To Watch - Find Your Next Movie" />
         <meta name="twitter:description" content="Discover your next favorite movie with a visually immersive experience." />
         <meta name="twitter:image" content="https://www.whichmovieto.watch/favicon_io/android-chrome-512x512.png" />
         ```
       - These are static defaults for the homepage. React 19 dynamic meta tags (from Plan 08-03 MovieMetaTags) will override these client-side when viewing specific movies.

    3. **Run final production build verification:**
       - Run `npm run build` and verify:
         - Build completes without errors.
         - Check chunk sizes in output — confirm main bundle (excluding 3D) under 500KB gzipped.
         - CSP meta tag present in built `dist/index.html`.
         - OG/Twitter meta tags present in built `dist/index.html`.
         - Privacy route works in built output.
  </action>
  <verify>
    - `npm run build` succeeds.
    - `dist/index.html` contains CSP meta tag, OG meta tags, Twitter Card meta tags.
    - Deploy workflow YAML is valid (check syntax).
    - `npx tsc --noEmit` passes.
  </verify>
  <done>Deploy workflow includes Lighthouse CI (non-blocking). Default OG/Twitter meta tags in index.html for social previews. Production build verified clean.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Final human verification of all Phase 8 deliverables</name>
  <files></files>
  <action>
    Human verifies all Phase 8 deliverables work correctly end-to-end. No code changes — this is a verification checkpoint.

    What was built across all 5 plans:
    1. WCAG 2.1 AA accessibility: color contrast fixes, keyboard navigation, focus management, ARIA semantics
    2. Performance: responsive srcset on all TMDB images, bundle size verification, API caching confirmation
    3. Social sharing: floating share button on Discovery page, story card generator, OG/Twitter meta tags
    4. Privacy: dedicated /privacy route, Simple Analytics integration
    5. Security: Content Security Policy meta tag
    6. Deployment: Lighthouse CI in pipeline, default OG meta tags
  </action>
  <verify>
    1. **Accessibility:**
       - Tab through the entire app (Home, Discover, Trending, Dinner Time, Free Movies). All interactive elements reachable.
       - Activate Skip Link (Tab once from browser chrome, then Enter). Focus should move to main content.
       - Open Discovery page with a movie. Use keyboard only to Love, Watch, Skip the movie.
       - Toggle between all 6 theme variants. Verify text is readable (no washed-out muted text).

    2. **Performance:**
       - Open DevTools Network tab. Load Discovery page. Check poster images have srcset attribute.
       - Run npm run build — verify terminal output shows no errors and chunk sizes are reasonable.

    3. **Social Sharing:**
       - Open Discovery page with a movie loaded. Floating share button should appear at bottom-right.
       - Click share button (desktop) — custom share menu with Copy Link, Instagram Story, Twitter/X, WhatsApp.
       - Click Copy Link — paste somewhere to verify.
       - Click Instagram Story — PNG file downloads. Open it — should show movie poster with title, rating, branding.
       - Inspect head in DevTools — og:title, og:image, twitter:card tags should match current movie.

    4. **Privacy and Analytics:**
       - Navigate to /#/privacy — full privacy policy page should render.
       - Footer Privacy link should navigate there (not to privacy.html).
       - DevTools Network tab: scripts.simpleanalyticscdn.com/latest.js should load.

    5. **Security:**
       - View page source — CSP meta tag should appear after the FOUC script.
       - Browser console should show NO CSP violation errors during normal usage.
       - Theme toggle should work (FOUC script not blocked).

    6. **Deployment:**
       - Inspect .github/workflows/deploy.yml — Lighthouse CI step present with continue-on-error: true.
  </verify>
  <done>Human confirms all Phase 8 deliverables work correctly. Type "approved" if all checks pass, or describe specific issues to fix.</done>
</task>

</tasks>

<verification>
1. Production build completes without errors.
2. All Phase 8 requirements verified via human testing.
3. No regressions in existing functionality (theme toggle, 3D scene, movie discovery, search).
</verification>

<success_criteria>
- Deployment pipeline includes Lighthouse CI as non-blocking check
- Default OG/Twitter meta tags in index.html for homepage social previews
- Human verification confirms all Phase 8 deliverables work correctly
- No regressions in existing app functionality
</success_criteria>

<output>
After completion, create `.planning/phases/08-polish-optimization/08-05-SUMMARY.md`
</output>
