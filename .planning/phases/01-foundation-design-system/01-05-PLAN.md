---
phase: 01-foundation-design-system
plan: 05
type: execute
wave: 4
depends_on: ["01-03", "01-04"]
files_modified:
  - src/components/ui/RotaryDial.tsx
  - src/components/ui/ThemeToggle.tsx
  - src/components/ui/index.ts
  - src/components/layout/Navbar.tsx
  - src/components/layout/AppShell.tsx
  - src/hooks/useSound.ts
  - src/App.tsx
  - public/sounds/dial-tick.mp3
autonomous: true

must_haves:
  truths:
    - "User can toggle between light and dark modes using a skeuomorphic toggle switch in the navbar"
    - "User can switch color presets by clicking a rotary dial that rotates between 3 positions with spring animation"
    - "Rotary dial plays a subtle tick sound when landing on a preset"
    - "Theme transition shows clay reshape animation (elements flatten then re-inflate)"
    - "Navbar is always visible with theme controls (toggle + dial) side by side"
    - "AppShell wraps all content with proper layout structure"
  artifacts:
    - path: "src/components/ui/RotaryDial.tsx"
      provides: "Skeuomorphic rotary knob that clicks between 3 color presets"
      exports: ["RotaryDial"]
    - path: "src/components/ui/ThemeToggle.tsx"
      provides: "Skeuomorphic dark/light toggle switch"
      exports: ["ThemeToggle"]
    - path: "src/components/ui/index.ts"
      provides: "Barrel export for all UI components"
      contains: "export"
    - path: "src/components/layout/Navbar.tsx"
      provides: "Top navigation bar with theme controls"
      exports: ["Navbar"]
    - path: "src/components/layout/AppShell.tsx"
      provides: "Root layout wrapper with clay reshape theme transition"
      exports: ["AppShell"]
    - path: "src/hooks/useSound.ts"
      provides: "Web Audio API hook for dial tick sound"
      exports: ["useSound", "playTick"]
  key_links:
    - from: "src/components/ui/RotaryDial.tsx"
      to: "src/stores/themeStore.ts"
      via: "useThemeStore to read/set preset"
      pattern: "useThemeStore|setPreset"
    - from: "src/components/ui/RotaryDial.tsx"
      to: "src/hooks/useSound.ts"
      via: "playTick on preset change"
      pattern: "playTick"
    - from: "src/components/ui/ThemeToggle.tsx"
      to: "src/stores/themeStore.ts"
      via: "useThemeStore to toggle mode"
      pattern: "toggleMode"
    - from: "src/components/layout/Navbar.tsx"
      to: "src/components/ui/RotaryDial.tsx"
      via: "Renders RotaryDial and ThemeToggle"
      pattern: "RotaryDial|ThemeToggle"
    - from: "src/components/layout/AppShell.tsx"
      to: "src/hooks/useTheme.ts"
      via: "useTheme for mode+preset, wraps children in AnimatePresence"
      pattern: "useTheme"
---

<objective>
Build the signature theme control experience: skeuomorphic RotaryDial for color presets with tick sound, ThemeToggle for dark/light mode, Navbar with theme controls always visible, and AppShell with clay reshape theme transition animation. Create barrel export for all UI components.

Purpose: Deliver the centerpiece interaction of the design system — the premium hardware theme controls that make switching themes feel like operating high-end audio equipment. This plan integrates all components from Plans 03-04 into a cohesive layout.
Output: A fully interactive theme system with rotary dial, toggle switch, and animated theme transitions wrapped in a persistent navbar layout.
</objective>

<execution_context>
@/Users/kohulanrajan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kohulanrajan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-design-system/01-RESEARCH.md
@.planning/phases/01-foundation-design-system/01-03-SUMMARY.md
@.planning/phases/01-foundation-design-system/01-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useSound hook and RotaryDial + ThemeToggle components</name>
  <files>
    src/hooks/useSound.ts
    src/components/ui/RotaryDial.tsx
    src/components/ui/ThemeToggle.tsx
    public/sounds/dial-tick.mp3
  </files>
  <action>
    **Part A: useSound hook** (`src/hooks/useSound.ts`)

    Implement Web Audio API sound playback for zero-latency dial tick:

    1. Create a module-level AudioContext (lazily initialized on first user gesture):
       ```typescript
       let audioContext: AudioContext | null = null;
       let tickBuffer: AudioBuffer | null = null;
       let initialized = false;
       ```

    2. `initAudio()` function: creates AudioContext, fetches and decodes `/sounds/dial-tick.mp3`. Called lazily — wrap in a document-level click/touchstart listener that runs once then removes itself. This satisfies browser autoplay policy.

    3. `playTick()` function: if buffer loaded, create BufferSource, connect to destination, start(0). If not initialized, silently skip (no error).

    4. Export `playTick` and `initAudio`.

    **Part B: dial-tick.mp3 sound file** (`public/sounds/dial-tick.mp3`)

    Generate a minimal dial tick sound file. Options:
    - Create a tiny MP3 programmatically using the Web Audio API's `OscillatorNode` and `OfflineAudioContext` to produce a ~50ms click sound at build time. OR
    - Create a minimal placeholder MP3 file (can be a very short silent or tonal burst — the important thing is the file exists and the audio pipeline works). The user can replace with a real tick sound later.
    - Simplest approach: use a base64-encoded minimal MP3 data and write it to the file. A basic click/tick sound is approximately 2-5KB.

    For implementation simplicity, create a JavaScript utility that generates the sound file, OR use a publicly available click sound. The priority is that the audio pipeline is functional.

    **Part C: RotaryDial** (`src/components/ui/RotaryDial.tsx`)

    Per user decision: "Color preset switcher is a skeuomorphic rotary dial/knob — premium hardware-style selector that clicks between 3 positions. Dial has click animation + subtle 'tick' sound when landing on a preset."

    1. Define presets and angles:
       ```typescript
       const PRESETS = ['cinema-gold', 'ocean-blue', 'neon-purple'] as const;
       const ANGLES = [0, 120, 240]; // 3 positions at 120 degrees apart
       ```

    2. Read `preset` and `setPreset` from `useThemeStore`
    3. Calculate current index and target angle
    4. On click: advance to next preset (cycle), call `setPreset`, call `playTick()`
    5. Render `motion.div` with:
       - 48x48px (w-12 h-12), rounded-full
       - `.metal-knob` radial gradient background
       - `.metal-shadow` box shadow
       - `animate={{ rotate: targetAngle }}` with spring: stiffness 300, damping 20
       - Indicator notch: small `bg-accent` pill at top of dial (rotates with the dial)
       - Three position markers around the outside (small dots at 0, 120, 240 degrees)
    6. Accessible: role="listbox", aria-label="Color theme selector", aria-activedescendant for current preset. Also add keyboard support: left/right arrows cycle presets.

    **Part D: ThemeToggle** (`src/components/ui/ThemeToggle.tsx`)

    Per user decision: "Dark/light toggle is a skeuomorphic hardware toggle switch matching the premium aesthetic."

    This IS a MetalToggle specifically for dark/light mode. Reuse or compose with MetalToggle from Plan 04:

    1. Read `mode` and `toggleMode` from `useThemeStore`
    2. Render a toggle switch (can wrap or duplicate MetalToggle pattern):
       - Track: 52px wide, 28px tall, rounded-full
       - Off (light) state: lighter track, sun icon (Lucide `Sun`) on the left
       - On (dark) state: darker track with accent tint, moon icon (Lucide `Moon`) on the right
       - Metal knob slides with spring animation
       - Icons are small (14px) and positioned inside the track to indicate current state
    3. On click: call `toggleMode()`
    4. Accessible: role="switch", aria-checked, aria-label="Toggle dark mode"
  </action>
  <verify>
    1. Render RotaryDial and ThemeToggle in App.tsx
    2. Click RotaryDial — it rotates 120 degrees with spring animation and a tick sound plays
    3. Click ThemeToggle — dark/light mode toggles with knob sliding animation
    4. Theme changes are reflected across all existing components (clay + metal)
    5. Audio works after first click (browser autoplay policy satisfied)
    6. Keyboard: arrow keys on RotaryDial cycle presets, Enter/Space on ThemeToggle toggles
  </verify>
  <done>RotaryDial rotates between 3 preset positions with tick sound, ThemeToggle slides between dark/light with sun/moon icons, both using premium metal hardware aesthetic with spring animations.</done>
</task>

<task type="auto">
  <name>Task 2: Build Navbar, AppShell with clay reshape animation, and barrel export</name>
  <files>
    src/components/layout/Navbar.tsx
    src/components/layout/AppShell.tsx
    src/components/ui/index.ts
    src/App.tsx
  </files>
  <action>
    **Part A: Navbar** (`src/components/layout/Navbar.tsx`)

    Per user decision: "Theme controls always visible in top nav bar — toggle + preset dial side by side."

    1. Render a fixed/sticky top navbar:
       - Full width, clay surface background (`bg-clay-surface`), `.clay-shadow-sm` for subtle elevation
       - Height: ~64px (comfortable for touch targets)
       - Layout: flex, items-center, justify-between, px-4 to px-6
       - Left side: App title "WhichMovieToWatch" or a logo placeholder in `font-heading text-clay-text`
       - Right side: `ThemeToggle` and `RotaryDial` side by side with a small gap (gap-3)
    2. Responsive: on mobile (< 768px), condense spacing but keep both controls visible. The toggle and dial are small enough to fit.
    3. Clay texture on navbar surface (`.clay-texture`)
    4. z-50 to stay above content

    **Part B: AppShell** (`src/components/layout/AppShell.tsx`)

    Root layout wrapper that:
    1. Calls `useTheme()` to activate theme class application
    2. Renders `<Navbar />` at the top
    3. Wraps `{children}` (or `<Outlet />` from react-router) in the clay reshape animation:
       - Use `AnimatePresence mode="wait"` with `motion.div` keyed on `${mode}-${preset}`
       - Entry: scaleY from 0.95, scaleX from 0.98, opacity from 0.7
       - Animate: scaleY 1, scaleX 1, opacity 1
       - Exit: scaleY to 0.95, scaleX to 0.98, opacity to 0.7
       - Spring transition for scale (stiffness 150, damping 12, mass 0.8), quick opacity (duration 0.15)
       - Per user decision: "Clay reshape animation — elements briefly flatten then re-inflate with new colors"
    4. Main content area: padding-top to account for fixed navbar height, `bg-clay-base min-h-screen`
    5. Accessible: `<main>` element for content area, `<nav>` for navbar

    **Part C: Barrel export** (`src/components/ui/index.ts`)

    Export all UI components from a single barrel file:
    ```typescript
    // Clay components
    export { ClayCard } from './ClayCard';
    export { ClayModal } from './ClayModal';
    export { ClayInput } from './ClayInput';
    export { ClayBadge } from './ClayBadge';
    export { ClaySkeletonCard } from './ClaySkeletonCard';

    // Metal/hardware components
    export { MetalButton } from './MetalButton';
    export { MetalToggle } from './MetalToggle';
    export { MetalSlider } from './MetalSlider';
    export { MetalCheckbox } from './MetalCheckbox';
    export { MetalDropdown } from './MetalDropdown';

    // Theme controls
    export { RotaryDial } from './RotaryDial';
    export { ThemeToggle } from './ThemeToggle';
    ```

    **Part D: Update App.tsx**

    Replace the temporary test buttons from Plan 02 with the proper layout:
    1. Render `<AppShell>` wrapping all content
    2. Remove the manual theme test buttons (RotaryDial and ThemeToggle are now in Navbar)
    3. Keep a simple content area showing the app title and a brief component showcase (for verification)
    4. Import from `react-router` `Outlet` — if routes are set up, render Outlet; otherwise render showcase content directly
  </action>
  <verify>
    1. App renders with Navbar at top containing ThemeToggle and RotaryDial side by side
    2. Toggle dark/light — clay reshape animation plays (content briefly flattens then re-inflates)
    3. Click RotaryDial — clay reshape animation plays with color change
    4. Navbar stays visible while scrolling (sticky/fixed)
    5. Content area has proper padding below navbar
    6. Background is clay-base color, adapts to all 6 theme variants
    7. All components importable from '@/components/ui' barrel export
    8. Remove temporary test buttons — theme controls live exclusively in Navbar now
  </verify>
  <done>Navbar with premium theme controls (toggle + rotary dial), AppShell with clay reshape animation on theme changes, barrel export for all 12 UI components, and clean App.tsx without temporary test code.</done>
</task>

</tasks>

<verification>
- Navbar visible at top with both theme controls
- RotaryDial clicks between 3 presets with rotation + tick sound
- ThemeToggle switches dark/light with sliding knob + sun/moon icons
- Clay reshape animation visible on every theme change (flatten -> inflate)
- All 6 theme variants render correctly through the complete UI
- Barrel import works: `import { ClayCard, MetalButton, RotaryDial } from '@/components/ui'`
- Layout responsive: navbar works on mobile-width viewport
- No console errors
</verification>

<success_criteria>
The centerpiece theme experience is complete: a premium rotary dial with tick sound clicks between dramatically different color worlds, a skeuomorphic toggle slides between light and dark, and every theme change triggers the signature clay reshape animation. All 12 UI components are accessible from a single barrel import.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-design-system/01-05-SUMMARY.md`
</output>
