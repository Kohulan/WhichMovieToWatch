---
phase: 01-foundation-design-system
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/stores/themeStore.ts
  - src/hooks/useTheme.ts
  - src/styles/app.css
  - index.html
autonomous: true

must_haves:
  truths:
    - "User can toggle between light and dark modes and see the entire UI adapt"
    - "User can switch between Cinema Gold, Ocean Blue, and Neon Purple presets"
    - "Application respects system color scheme preference on first visit"
    - "Theme preference persists in localStorage across page reloads"
    - "No flash of wrong theme on page load (FOUC prevention)"
    - "Dark mode uses dark-colored clay material, not dimmed lighting"
  artifacts:
    - path: "src/stores/themeStore.ts"
      provides: "Zustand store with persist middleware for theme mode and preset"
      exports: ["useThemeStore"]
    - path: "src/hooks/useTheme.ts"
      provides: "Theme hook with system detection, class application, media query listener"
      exports: ["useTheme"]
    - path: "src/styles/app.css"
      provides: "All 6 theme variant CSS variable blocks (3 presets x light/dark)"
      contains: "theme-cinema-gold"
    - path: "index.html"
      provides: "Inline script for theme flash prevention"
      contains: "theme-preferences"
  key_links:
    - from: "src/hooks/useTheme.ts"
      to: "src/stores/themeStore.ts"
      via: "useThemeStore import"
      pattern: "useThemeStore"
    - from: "src/hooks/useTheme.ts"
      to: "document.documentElement"
      via: "classList toggle for dark/theme-* classes"
      pattern: "classList"
    - from: "index.html"
      to: "localStorage"
      via: "Inline script reads theme-preferences before React mounts"
      pattern: "theme-preferences"
    - from: "src/styles/app.css"
      to: "document.documentElement"
      via: "CSS selectors match .dark and .theme-* classes on html"
      pattern: "\\.dark\\.theme-"
---

<objective>
Build the complete theme system: Zustand store with localStorage persistence, useTheme hook with system preference detection, all 6 CSS variable theme variants (Cinema Gold, Ocean Blue, Neon Purple each in light and dark), and FOUC-prevention inline script.

Purpose: Enable the entire UI to reactively adapt to theme changes. All subsequent component plans depend on these CSS variables being available and toggleable.
Output: A working theme system where CSS classes on `<html>` drive all visual changes through CSS custom property overrides.
</objective>

<execution_context>
@/Users/kohulanrajan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kohulanrajan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-design-system/01-RESEARCH.md
@.planning/phases/01-foundation-design-system/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Zustand theme store with localStorage persistence</name>
  <files>
    src/stores/themeStore.ts
  </files>
  <action>
    Create the Zustand store for theme state management:

    1. Define types:
       ```typescript
       type ColorPreset = 'cinema-gold' | 'ocean-blue' | 'neon-purple';
       type ThemeMode = 'light' | 'dark';
       ```

    2. Create store using `create` with `persist` middleware from `zustand/middleware`:
       - State: `mode: ThemeMode` (default 'light'), `preset: ColorPreset` (default 'cinema-gold')
       - Actions: `setMode(mode)`, `toggleMode()`, `setPreset(preset)`
       - Persist config:
         - name: `'theme-preferences'` (this key is referenced by the FOUC prevention script)
         - storage: `createJSONStorage(() => localStorage)`
       - Export both the store hook (`useThemeStore`) and the types (`ColorPreset`, `ThemeMode`)

    **Important:** The store key MUST be `'theme-preferences'` — the inline FOUC prevention script in index.html reads this exact key.
  </action>
  <verify>
    In browser console: `JSON.parse(localStorage.getItem('theme-preferences'))` returns an object with `state.mode` and `state.preset` after interacting with the store.
  </verify>
  <done>Zustand theme store persists mode and preset to localStorage under 'theme-preferences' key with proper TypeScript types exported.</done>
</task>

<task type="auto">
  <name>Task 2: Create useTheme hook and all 6 theme CSS variants + FOUC prevention</name>
  <files>
    src/hooks/useTheme.ts
    src/styles/app.css
    index.html
  </files>
  <action>
    **Part A: useTheme hook** (`src/hooks/useTheme.ts`)

    Create a hook that:
    1. Reads `mode`, `preset`, `setMode`, `toggleMode`, `setPreset` from `useThemeStore`
    2. On mount, checks if this is first visit (no 'theme-preferences' in localStorage):
       - If first visit: detect system preference via `window.matchMedia('(prefers-color-scheme: dark)')` and call `setMode` accordingly
    3. Applies CSS classes to `document.documentElement` whenever mode or preset changes:
       - Toggle `'dark'` class based on mode
       - Remove any existing `theme-*` class, then add `theme-${preset}`
    4. Listens for `prefers-color-scheme` media query changes and updates mode (only if user hasn't manually toggled — use a ref or check)
    5. Returns: `{ mode, preset, toggleMode, setPreset, setMode }`

    **Part B: All 6 theme variants in CSS** (`src/styles/app.css`)

    Add CSS variable blocks for ALL 6 combinations. Use oklch() color space for perceptual uniformity. Each preset must feel like "entering a different room" per user decision.

    The CSS structure uses compound selectors: `.theme-{preset}` for light, `.dark.theme-{preset}` for dark.

    **Cinema Gold (warm luxury):**
    - Light: Warm cream/beige base, muted gold accents, charcoal text. Brass metal.
    - Dark: Deep warm charcoal base (oklch ~0.22), rich gold accents, cream text. Dark brass metal.

    **Ocean Blue (deep ocean):**
    - Light: Pale blue-grey base, teal/navy accents, dark navy text. Chrome metal.
    - Dark: Deep navy base (oklch ~0.20), bright teal/seafoam accents, light blue text. Cool dark chrome metal.

    **Neon Purple (cyberpunk/synthwave):**
    - Light: Pale lavender/lilac base, electric purple/hot pink accents, dark purple text. Gunmetal.
    - Dark: Very dark purple/near-black base (oklch ~0.18), neon purple/cyan/pink accents, bright violet text. Dark gunmetal.

    Each block must define ALL these variables:
    ```
    --clay-base, --clay-surface, --clay-elevated, --clay-shadow, --clay-highlight
    --clay-text, --clay-text-muted
    --metal-base, --metal-shine, --metal-dark
    --accent, --accent-hover
    ```

    **Color contrast requirement (A11Y-06):** Ensure --clay-text against --clay-base achieves minimum 4.5:1 contrast ratio in ALL 6 variants. For dark modes, text colors must be light enough against dark backgrounds. For Neon Purple especially, verify the high-contrast cyberpunk colors still meet WCAG AA.

    The `:root` fallback block (from Plan 01) should be kept as-is or updated to match Cinema Gold Light exactly. Also add `.theme-cinema-gold` selector to match it:
    ```css
    :root,
    .theme-cinema-gold { /* Cinema Gold Light values */ }
    .dark.theme-cinema-gold { /* Cinema Gold Dark values */ }
    .theme-ocean-blue { /* Ocean Blue Light values */ }
    .dark.theme-ocean-blue { /* Ocean Blue Dark values */ }
    .theme-neon-purple { /* Neon Purple Light values */ }
    .dark.theme-neon-purple { /* Neon Purple Dark values */ }
    ```

    **Part C: FOUC prevention script** (`index.html`)

    Replace the placeholder script in index.html `<head>` with:
    ```html
    <script>
      (function() {
        try {
          var stored = JSON.parse(localStorage.getItem('theme-preferences'));
          if (stored && stored.state) {
            if (stored.state.mode === 'dark') document.documentElement.classList.add('dark');
            if (stored.state.preset) document.documentElement.classList.add('theme-' + stored.state.preset);
          } else {
            // First visit: check system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              document.documentElement.classList.add('dark');
            }
            // Default preset
            document.documentElement.classList.add('theme-cinema-gold');
          }
        } catch(e) {
          document.documentElement.classList.add('theme-cinema-gold');
        }
      })();
    </script>
    ```

    **Part D: Wire useTheme into App.tsx**

    Update `src/App.tsx` to call `useTheme()` at the top of the component. Add temporary theme test buttons:
    - A button that calls `toggleMode()` labeled "Toggle Dark/Light"
    - Three buttons that call `setPreset('cinema-gold')`, `setPreset('ocean-blue')`, `setPreset('neon-purple')`

    This allows visual verification that all 6 theme variants work before building the proper RotaryDial and toggle switch in Plan 05.
  </action>
  <verify>
    1. On first visit (clear localStorage), app detects system preference and applies correct mode
    2. Clicking "Toggle Dark/Light" changes the background and text colors visibly
    3. Clicking each preset button dramatically changes the color palette
    4. Reload the page — theme persists (no flash of wrong theme)
    5. In browser DevTools, `document.documentElement.classList` shows correct `dark` and `theme-*` classes
    6. All 6 combinations (3 presets x 2 modes) have distinct, visible color differences
    7. Text is readable in all 6 variants (contrast check)
  </verify>
  <done>Complete theme system with 6 variants (Cinema Gold, Ocean Blue, Neon Purple x light/dark), Zustand persistence, system preference detection, FOUC prevention, and temporary test buttons for visual verification. All text meets 4.5:1 contrast minimum.</done>
</task>

</tasks>

<verification>
- Toggle dark/light mode — colors change dramatically, not just dimming
- Switch between all 3 presets — each feels like a different room
- Reload page — same theme as before, no flash
- Clear localStorage, reload — system preference detected
- Check 6 variants: Cinema Gold Light, Cinema Gold Dark, Ocean Blue Light, Ocean Blue Dark, Neon Purple Light, Neon Purple Dark
- Text readability in all variants
</verification>

<success_criteria>
A fully functional theme system with 6 visual variants, localStorage persistence, system preference detection, FOUC prevention, and CSS custom properties driving all color changes through class toggles on the html element.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-design-system/01-02-SUMMARY.md`
</output>
