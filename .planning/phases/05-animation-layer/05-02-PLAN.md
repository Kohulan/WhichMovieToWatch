---
phase: 05-animation-layer
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/animation/PageTransition.tsx
  - src/components/layout/AppShell.tsx
  - src/components/discovery/DiscoveryPage.tsx
  - src/components/dinner-time/DinnerTimePage.tsx
  - src/components/free-movies/FreeMoviesPage.tsx
  - src/components/movie/MovieHero.tsx
autonomous: true
requirements: [ANIM-01, ANIM-04]

must_haves:
  truths:
    - "User experiences smooth page transitions when navigating between all 4 tabs (fade+slide, 300-450ms)"
    - "Next Movie on Discovery dissolves current movie and morphs in the new one with blur+scale transition"
    - "Backdrop image crossfades between movies instead of hard-cutting"
    - "Similar movie poster can expand into the hero poster via layoutId shared animation"
  artifacts:
    - path: "src/components/animation/PageTransition.tsx"
      provides: "Reusable page transition variant definitions"
      exports: ["pageVariants", "pageTransition"]
    - path: "src/components/layout/AppShell.tsx"
      provides: "Enhanced route transitions with richer variants"
      contains: "pageVariants"
    - path: "src/components/discovery/DiscoveryPage.tsx"
      provides: "Morph transition for Next Movie, backdrop crossfade, layoutId on similar movie posters"
      contains: "AnimatePresence"
    - path: "src/components/movie/MovieHero.tsx"
      provides: "layoutId on poster image for hero expand animation"
      contains: "layoutId"
  key_links:
    - from: "src/components/layout/AppShell.tsx"
      to: "src/components/animation/PageTransition.tsx"
      via: "imports pageVariants and pageTransition"
      pattern: "import.*PageTransition"
    - from: "src/components/discovery/DiscoveryPage.tsx"
      to: "AnimatePresence"
      via: "wraps movie hero section with key={currentMovie.id}"
      pattern: "AnimatePresence.*mode.*wait"
---

<objective>
Add enriched page transitions between routes and layout/morph animations within pages: morph transition for Next Movie on Discovery, backdrop crossfade, and layoutId hero expand for similar movie posters.

Purpose: ANIM-01 (page transitions) and ANIM-04 (layout animations) are the highest-impact animation features — they transform navigation from instant page swaps to fluid cinematic experiences.

Output: PageTransition variants module, enhanced AppShell transitions, DiscoveryPage morph/crossfade, MovieHero layoutId, DinnerTimePage/FreeMoviesPage morph transitions.
</objective>

<execution_context>
@/Users/kohulanrajan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kohulanrajan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-animation-layer/05-RESEARCH.md
@.planning/phases/05-animation-layer/05-CONTEXT.md
@.planning/phases/05-animation-layer/05-01-SUMMARY.md
@src/components/layout/AppShell.tsx
@src/components/discovery/DiscoveryPage.tsx
@src/components/movie/MovieHero.tsx
@src/components/dinner-time/DinnerTimePage.tsx
@src/components/free-movies/FreeMoviesPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PageTransition variants and enhance AppShell route transitions</name>
  <files>
    src/components/animation/PageTransition.tsx
    src/components/layout/AppShell.tsx
  </files>
  <action>
    1. Create `src/components/animation/PageTransition.tsx`:
       - Export `pageVariants` object with `initial`, `animate`, `exit` states:
         - `initial`: `{ opacity: 0, y: 20, scale: 0.98 }` — subtle slide-up with slight scale-down
         - `animate`: `{ opacity: 1, y: 0, scale: 1 }` — fully visible at natural position
         - `exit`: `{ opacity: 0, y: -12, scale: 0.99 }` — slide up slightly on exit
       - Export `pageTransition` object: `{ duration: 0.35, ease: [0.25, 0.1, 0.25, 1] }` — 350ms with custom cubic-bezier for premium feel (per locked decision: 300-450ms range)
       - This is a pure data module — no JSX components. The variants are applied by AppShell.

    2. Update `src/components/layout/AppShell.tsx`:
       - Import `pageVariants` and `pageTransition` from `@/components/animation/PageTransition`
       - Replace the current inline animation props on `<motion.main>`:
         - Change `initial={{ opacity: 0, y: 12 }}` to `variants={pageVariants}` with `initial="initial"` `animate="animate"` `exit="exit"`
         - Change `transition={{ duration: 0.3, ease: ... }}` to `transition={pageTransition}`
       - This enhances the existing simple fade+slide with the richer combined fade+slide+scale variant
       - Keep `AnimatePresence mode="wait"` and `key={location.pathname}` — those are correct
  </action>
  <verify>
    - `npm run build` succeeds
    - `grep "pageVariants" src/components/layout/AppShell.tsx` shows import and usage
    - `grep "scale" src/components/animation/PageTransition.tsx` confirms scale is part of variants
  </verify>
  <done>Page transitions between all 4 tabs use a combined fade+slide+scale variant at 350ms with premium easing. AppShell reads variants from centralized PageTransition module.</done>
</task>

<task type="auto">
  <name>Task 2: Add morph transitions, backdrop crossfade, and layoutId hero expand</name>
  <files>
    src/components/discovery/DiscoveryPage.tsx
    src/components/movie/MovieHero.tsx
    src/components/dinner-time/DinnerTimePage.tsx
    src/components/free-movies/FreeMoviesPage.tsx
  </files>
  <action>
    **DiscoveryPage.tsx** — Three animation additions:

    1. **Morph transition for Next Movie** (ANIM-04): Wrap the hero section (the `<section>` containing `<MovieHero>`) in `<AnimatePresence mode="wait">` with a `<motion.div>` keyed by `currentMovie.id`. Apply:
       - `initial={{ opacity: 0, scale: 0.95, filter: 'blur(4px)' }}`
       - `animate={{ opacity: 1, scale: 1, filter: 'blur(0px)' }}`
       - `exit={{ opacity: 0, scale: 1.02, filter: 'blur(6px)' }}`
       - `transition={{ duration: 0.4, ease: [0.25, 0.1, 0.25, 1] }}`
       - Import `AnimatePresence` and `motion` from `motion/react` (AnimatePresence may already be imported; check first)

    2. **Backdrop crossfade**: Replace the current backdrop `<img>` tag with `<AnimatePresence mode="wait">` wrapping a `<motion.img>` keyed by `currentMovie.id`. Apply:
       - `initial={{ opacity: 0 }}`
       - `animate={{ opacity: 1 }}`
       - `exit={{ opacity: 0 }}`
       - `transition={{ duration: 0.5 }}`
       - Keep the gradient overlay div outside the AnimatePresence (it stays constant)

    3. **layoutId on similar movie posters**: On each similar movie poster `<img>` (or the poster fallback `<div>`), add `layoutId={`similar-poster-${movie.id}`}`. Use the prefix `similar-` to avoid collisions with other pages. Wrap each similar movie button in `motion.button` if not already (change the `<button>` to `<motion.button>` with `layout` prop).

    **MovieHero.tsx** — layoutId on poster:
    - Accept an optional `movieId` prop (type `number | undefined`) for layoutId
    - On the poster `<img>` element, add `layoutId={movieId ? `similar-poster-${movieId}` : undefined}`
    - Wrap the `<img>` in a `motion.img` (change `<img>` to `<motion.img>`) for the layoutId to work. Import `motion` from `motion/react`
    - Add the `movieId` prop to the MovieHeroProps interface
    - In DiscoveryPage, pass `movieId={currentMovie.id}` to MovieHero

    **DinnerTimePage.tsx** — Morph transition for Next Movie:
    - Wrap the movie hero section in `<AnimatePresence mode="wait">` with `<motion.div key={movie.id}>` using the same morph variants as DiscoveryPage (initial blur+scale, animate normal, exit blur+scale)
    - Add backdrop crossfade: same pattern as DiscoveryPage — `<AnimatePresence>` around backdrop `<motion.img>`

    **FreeMoviesPage.tsx** — Morph transition for Next Movie:
    - Same pattern as DinnerTimePage: wrap hero section in AnimatePresence with keyed motion.div, add backdrop crossfade

    Spring physics per research: Use tween with `duration: 0.4, ease: [0.25, 0.1, 0.25, 1]` for morph transitions (not spring — morph should be smooth and controlled, not bouncy).
  </action>
  <verify>
    - `npm run build` succeeds
    - `grep "AnimatePresence" src/components/discovery/DiscoveryPage.tsx` confirms wrapper exists
    - `grep "layoutId" src/components/movie/MovieHero.tsx` confirms poster has layoutId
    - `grep "AnimatePresence" src/components/dinner-time/DinnerTimePage.tsx` confirms morph transition
    - `grep "AnimatePresence" src/components/free-movies/FreeMoviesPage.tsx` confirms morph transition
  </verify>
  <done>Discovery/DinnerTime/FreeMovies pages have morph transitions on Next Movie (blur+scale dissolve). Backdrop images crossfade between movies. Similar movie posters connect to MovieHero poster via layoutId for hero expand animation.</done>
</task>

</tasks>

<verification>
- `npm run build` passes cleanly
- Navigate between tabs: smooth fade+slide+scale transitions
- Tap "Next" on Discovery: current movie dissolves with blur, new one morphs in
- Backdrop image crossfades instead of hard-cutting
- Click similar movie poster: poster visually expands into hero position
</verification>

<success_criteria>
- Route transitions use combined fade+slide+scale at 350ms across all 4 tabs
- Next Movie action triggers a morph transition (blur + scale dissolve/reveal)
- Backdrop images crossfade on movie change (not instant swap)
- layoutId connects similar movie posters to MovieHero poster for spatial animation
- DinnerTimePage and FreeMoviesPage also have morph transitions on movie change
</success_criteria>

<output>
After completion, create `.planning/phases/05-animation-layer/05-02-SUMMARY.md`
</output>
