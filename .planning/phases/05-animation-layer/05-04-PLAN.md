---
phase: 05-animation-layer
plan: 04
type: execute
wave: 3
depends_on: ["05-01", "05-02"]
files_modified:
  - src/components/animation/AnimatedActionIcon.tsx
  - src/components/movie/MovieActions.tsx
  - src/components/layout/TabBar.tsx
  - src/components/layout/AppShell.tsx
  - src/components/search/SearchModal.tsx
autonomous: true
requirements: [ANIM-03, ANIM-07]

must_haves:
  truths:
    - "Love button plays a heart pulse animation when tapped (path draw + scale bounce)"
    - "Watched button plays a checkmark draw animation when tapped"
    - "Not Interested button plays an X slide-away animation when tapped"
    - "Tab bar has a sliding indicator that follows the active tab and icon bounces on activation"
    - "Search modal slides up from bottom with backdrop blur"
    - "AppShell ambient gradient blobs animate on theme preset change"
  artifacts:
    - path: "src/components/animation/AnimatedActionIcon.tsx"
      provides: "SVG path-draw animations for Love/Watched/Not Interested action icons"
      exports: ["HeartPulseIcon", "CheckDrawIcon", "XSlideIcon"]
    - path: "src/components/layout/TabBar.tsx"
      provides: "Tab bar with sliding indicator via layoutId and icon bounce"
      contains: "layoutId"
    - path: "src/components/search/SearchModal.tsx"
      provides: "Search modal with dramatic slide-up and backdrop blur entrance"
      contains: "motion.div"
  key_links:
    - from: "src/components/movie/MovieActions.tsx"
      to: "src/components/animation/AnimatedActionIcon.tsx"
      via: "replaces static icons with animated versions on action trigger"
      pattern: "HeartPulseIcon|CheckDrawIcon|XSlideIcon"
    - from: "src/components/layout/TabBar.tsx"
      to: "motion/react"
      via: "layoutId='tab-indicator' for sliding active tab background"
      pattern: "layoutId.*tab-indicator"
---

<objective>
Add micro-interaction animations: signature action button icons (heart pulse, checkmark draw, X slide), tab bar sliding indicator with icon bounce, dramatic search modal entrance, and animated theme transition on ambient gradient.

Purpose: ANIM-03 (micro-interactions) and ANIM-07 (theme transition animations) create the "refined precision" feel requested by the user — every interactive element provides immediate, intentional visual feedback like Apple's UI.

Output: AnimatedActionIcon components, enhanced TabBar with sliding indicator, dramatic SearchModal entrance, AppShell gradient animation on theme change.

Note: depends_on includes 05-02 because both 05-02 and 05-04 modify AppShell.tsx — 05-02 installs pageVariants on motion.main, and 05-04 adds animated gradient blobs. 05-02's AppShell changes must be present before 05-04 adds blob animations.
</objective>

<execution_context>
@/Users/kohulanrajan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kohulanrajan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-animation-layer/05-RESEARCH.md
@.planning/phases/05-animation-layer/05-CONTEXT.md
@.planning/phases/05-animation-layer/05-01-SUMMARY.md
@.planning/phases/05-animation-layer/05-02-SUMMARY.md
@src/components/movie/MovieActions.tsx
@src/components/layout/TabBar.tsx
@src/components/layout/AppShell.tsx
@src/components/search/SearchModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AnimatedActionIcon components and integrate into MovieActions</name>
  <files>
    src/components/animation/AnimatedActionIcon.tsx
    src/components/movie/MovieActions.tsx
  </files>
  <action>
    1. Create `src/components/animation/AnimatedActionIcon.tsx` with three exported components:

    **HeartPulseIcon** — for Love action:
    - Takes `animate: boolean` and `className?: string` props
    - Renders a `<motion.svg>` with viewBox="0 0 24 24" containing a `<motion.path>` with the heart SVG path (use lucide heart path: `M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z`)
    - When `animate=true`: path draws from `pathLength: 0` to `pathLength: 1` (duration 0.4), then the SVG scales `[1, 1.3, 1]` (duration 0.5, times [0, 0.5, 1]) — heart "pulses" after drawing
    - Spring physics: stiffness 400, damping 15 for the scale bounce
    - Fill: none initially, stroke: currentColor, strokeWidth: 2
    - When `animate=false`: static icon, no animation

    **CheckDrawIcon** — for Watched action:
    - Takes same props
    - Renders a `<motion.svg>` with a checkmark `<motion.path>` (path: `M20 6L9 17l-5-5`)
    - When `animate=true`: draws from `pathLength: 0` to `pathLength: 1` with `duration: 0.4, ease: 'easeOut'`
    - Fill: none, stroke: currentColor, strokeWidth: 2, strokeLinecap: round, strokeLinejoin: round

    **XSlideIcon** — for Not Interested action:
    - Takes same props
    - Renders a `<motion.svg>` with two `<motion.line>` elements forming an X (x1=18 y1=6 x2=6 y2=18 and x1=6 y1=6 x2=18 y2=18)
    - When `animate=true`: both lines animate `pathLength: 0` to `pathLength: 1` then the entire SVG translates `x: [0, 8, 0]` with spring stiffness 350, damping 22 — quick dismissal feel
    - Fill: none, stroke: currentColor, strokeWidth: 2

    2. Update `src/components/movie/MovieActions.tsx`:
    - Import `HeartPulseIcon`, `CheckDrawIcon`, `XSlideIcon` from `@/components/animation/AnimatedActionIcon`
    - Add state: `const [animatingAction, setAnimatingAction] = useState<'love' | 'watched' | 'skip' | null>(null)`
    - In `handleLove()`: set `setAnimatingAction('love')`, then after a 600ms timeout set it back to null (let animation play before the action triggers next movie)
    - In `handleWatched()`: set `setAnimatingAction('watched')`, 500ms timeout then null
    - In `handleNotInterested()`: set `setAnimatingAction('skip')`, 400ms timeout then null
    - Replace the static `<Heart>` icon in the Love button with `<HeartPulseIcon animate={animatingAction === 'love'} className="w-3.5 h-3.5" />`
    - Replace `<Eye>` in Watched with `<CheckDrawIcon animate={animatingAction === 'watched'} className="w-3.5 h-3.5" />`
    - Replace `<ThumbsDown>` in Skip with `<XSlideIcon animate={animatingAction === 'skip'} className="w-3.5 h-3.5" />`
    - Keep the `<SkipForward>` icon on the Next button unchanged — it doesn't need a signature animation
    - The setTimeout pattern ensures the icon animation plays visibly before the action handler triggers a movie change
  </action>
  <verify>
    - `npm run build` succeeds
    - `grep "HeartPulseIcon" src/components/movie/MovieActions.tsx` confirms import
    - `grep "pathLength" src/components/animation/AnimatedActionIcon.tsx` confirms SVG path draw animation
    - `grep "animatingAction" src/components/movie/MovieActions.tsx` confirms state management
  </verify>
  <done>Love button plays heart pulse (path draw + scale bounce). Watched button plays checkmark draw. Not Interested button plays X slide. Each animation plays before the action handler fires, creating visible feedback.</done>
</task>

<task type="auto">
  <name>Task 2: TabBar sliding indicator, SearchModal dramatic entrance, AppShell theme transition</name>
  <files>
    src/components/layout/TabBar.tsx
    src/components/search/SearchModal.tsx
    src/components/layout/AppShell.tsx
  </files>
  <action>
    **TabBar.tsx** — Sliding indicator + icon state change:
    - Import `motion` from `motion/react` and `useLocation` from `react-router`
    - Add `useLocation()` to get current pathname for active state detection
    - Move `tabs` array outside the component (module level) for stability
    - Change the NavLink render function to detect `isActive` via location.pathname matching (check `end` property for exact match on `/`)
    - Add a sliding background indicator: when `isActive`, render a `<motion.div layoutId="tab-indicator">` absolutely positioned behind the tab content. Style: `absolute inset-1 rounded-xl bg-accent/10`. Transition: `type: 'spring', stiffness: 350, damping: 30` — crisp snap, minimal overshoot
    - Add icon bounce on active: wrap each `<Icon>` in `<motion.div animate={isActive ? { scale: [1, 1.15, 1] } : { scale: 1 }} transition={{ duration: 0.3, ease: 'easeOut' }}>`. When tab becomes active, icon briefly scales up then back
    - Change icon strokeWidth: `isActive ? 2.5 : 1.5` (already exists, keep it)
    - Add `relative` to each NavLink className so the layoutId indicator positions correctly
    - Follow the code example in 05-RESEARCH.md "Tab Bar with Sliding Indicator" section

    **SearchModal.tsx** — Dramatic slide-up entrance:
    - The search modal already uses `AnimatePresence` and `motion` (verify by reading current code)
    - Find the main overlay/panel `motion.div` and enhance its entrance:
      - `initial={{ y: '100%', opacity: 0 }}`
      - `animate={{ y: 0, opacity: 1 }}`
      - `exit={{ y: '100%', opacity: 0 }}`
      - `transition={{ type: 'spring', stiffness: 300, damping: 30 }}` — same as current (keep it per research: "Already correct")
    - Find the backdrop overlay: enhance with `initial={{ backdropFilter: 'blur(0px)' }}` `animate={{ backdropFilter: 'blur(12px)' }}` for cinematic panel feel per user decision "slides up from bottom with backdrop blur"
    - If the backdrop already has `backdrop-blur` via CSS, this is fine — the CSS applies the static blur, motion handles the animated entrance

    **AppShell.tsx** — Animated ambient gradient on theme change:
    IMPORTANT: 05-02 will have already modified AppShell.tsx to install pageVariants on motion.main. Build on top of those changes, not the pre-05-02 version. Read AppShell.tsx at execution time to see 05-02's changes.
    - The three ambient gradient blobs (the `.rounded-full` divs in the background) currently use `bg-accent/[0.14]`, `bg-accent/[0.06]`, `bg-accent/[0.04]`
    - Convert these three `<div>` elements to `<motion.div>` elements
    - Add `key` based on the accent color (import `useThemeStore` to get `preset`): `key={`blob-1-${preset}`}`
    - Add AnimatePresence around the blob container with `mode="sync"` (not "wait" — we want crossfade, not sequential)
    - Blob entrance: `initial={{ opacity: 0, scale: 0.8 }}` `animate={{ opacity: 1, scale: 1 }}` `transition={{ duration: 0.8, ease: 'easeOut' }}`
    - Blob exit: `exit={{ opacity: 0, scale: 1.1 }}` `transition={{ duration: 0.5 }}`
    - This creates a smooth color/shape crossfade when switching between color presets (warm-orange to gold to clean-white)
    - ANIM-07: Theme CSS variables already use `transition-colors duration-500` for base color changes. The blob animation adds the visual "wow" on top.
  </action>
  <verify>
    - `npm run build` succeeds
    - `grep "layoutId.*tab-indicator" src/components/layout/TabBar.tsx` confirms sliding indicator
    - `grep "motion.div" src/components/layout/TabBar.tsx` confirms motion usage
    - `grep "'100%'" src/components/search/SearchModal.tsx` confirms slide-up from bottom
    - `grep "motion.div" src/components/layout/AppShell.tsx` confirms animated gradient blobs
  </verify>
  <done>Tab bar has a sliding accent indicator (layoutId) and icon bounce on tab switch. Search modal slides up from bottom with spring animation and backdrop blur. AppShell gradient blobs crossfade on theme preset change for smooth color transitions.</done>
</task>

</tasks>

<verification>
- `npm run build` passes cleanly
- Tap Love on Discovery: heart draws and pulses
- Tap Watched: checkmark draws on
- Tap Skip: X animates with slide
- Switch tabs: indicator slides smoothly between tabs, icon bounces
- Open search: modal slides up from bottom with blur backdrop
- Change theme preset via RotaryDial: gradient blobs crossfade to new accent color
</verification>

<success_criteria>
- Three signature action button animations (heart pulse, checkmark draw, X slide) play on their respective actions
- Tab bar sliding indicator uses layoutId for smooth inter-tab animation with spring physics
- Search modal entrance is a dramatic slide-up from bottom with backdrop blur
- Theme preset changes trigger smooth crossfade on AppShell gradient blobs
- All animations use "refined precision" spring parameters (crisp, controlled, minimal overshoot)
</success_criteria>

<output>
After completion, create `.planning/phases/05-animation-layer/05-04-SUMMARY.md`
</output>
