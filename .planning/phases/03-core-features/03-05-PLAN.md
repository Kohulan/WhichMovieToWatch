---
phase: 03-core-features
plan: 05
type: execute
wave: 3
depends_on: ["03-02", "03-03", "03-04"]
files_modified:
  - src/main.tsx
  - src/App.tsx
  - src/components/layout/AppShell.tsx
  - src/components/layout/Navbar.tsx
  - src/components/layout/TabBar.tsx
  - src/components/shared/Toast.tsx
autonomous: false
requirements:
  - DISC-03
  - INTR-05
  - A11Y-07

must_haves:
  truths:
    - "Tab bar at bottom shows Discover, Trending, Dinner Time, Free Movies tabs"
    - "Tapping a tab navigates to the correct page with route change"
    - "Active tab is visually highlighted"
    - "Search icon in navbar opens SearchModal"
    - "Toast notifications appear on all pages for user actions"
    - "All 5 pages render correctly and pass basic interactive verification"
    - "Routes are configured: / (discover), /trending, /dinner-time, /free-movies"
    - "Skip navigation link appears as first focusable element in AppShell"
  artifacts:
    - path: "src/components/layout/TabBar.tsx"
      provides: "Bottom tab bar navigation"
      contains: "TabBar"
    - path: "src/main.tsx"
      provides: "Router with all page routes configured"
      contains: "createHashRouter"
    - path: "src/components/layout/Navbar.tsx"
      provides: "Updated navbar with search icon"
      contains: "Search"
  key_links:
    - from: "src/components/layout/TabBar.tsx"
      to: "react-router"
      via: "NavLink for active state styling"
      pattern: "NavLink|useLocation"
    - from: "src/main.tsx"
      to: "all page components"
      via: "route definitions"
      pattern: "DiscoverPage|TrendingPage|DinnerTimePage|FreeMoviesPage"
    - from: "src/components/layout/Navbar.tsx"
      to: "SearchModal"
      via: "search icon opens modal"
      pattern: "SearchModal|setSearchOpen"
---

<objective>
Wire all Phase 3 features together: configure routes for all pages, add tab bar navigation, integrate search icon in navbar, add toast provider, and verify the complete feature set works end-to-end.

Purpose: Individual feature pages are useless without navigation between them. This plan connects all the pieces into a working application with the correct routing, navigation UI, and cross-cutting features (toast, search).

Output: Updated routing, TabBar component, Navbar with search, ToastProvider integration, and a verified end-to-end application.
</objective>

<execution_context>
@/Users/kohulanrajan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kohulanrajan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-features/03-01-SUMMARY.md
@.planning/phases/03-core-features/03-02-SUMMARY.md
@.planning/phases/03-core-features/03-03-SUMMARY.md
@.planning/phases/03-core-features/03-04-SUMMARY.md
@src/main.tsx
@src/App.tsx
@src/components/layout/Navbar.tsx
@src/components/layout/AppShell.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure routes, build TabBar, update Navbar with search, integrate Toast provider</name>
  <files>
    src/main.tsx
    src/App.tsx
    src/components/layout/AppShell.tsx
    src/components/layout/TabBar.tsx
    src/components/layout/Navbar.tsx
    src/components/shared/Toast.tsx
  </files>
  <action>
    Per user decision: "Tab bar / bottom nav for mode switching — Discover, Trending, Dinner Time, Free Movies accessible via persistent tabs."
    Per user decision: "Search accessed via icon in navbar."

    1. **Add skip navigation to AppShell** (`src/components/layout/AppShell.tsx`):
       - Add a skip nav link as the FIRST child element inside AppShell, before Navbar and all other content (A11Y-07).
       - `<a href="#main-content" className="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-[100] focus:px-4 focus:py-2 focus:bg-clay-surface focus:text-clay-text focus:rounded-lg focus:shadow-lg">Skip to main content</a>`
       - Add `id="main-content"` to the main content `<main>` element inside AppShell so the skip link target is correct.
       - This ensures skip nav is available on ALL pages (Discover, Trending, Dinner Time, Free Movies) since AppShell wraps all routes.

    2. **Update main.tsx** — Add routes for all pages:
       - Keep existing `App` layout wrapper with `Outlet`.
       - Routes:
         - `{ index: true, element: <DiscoverPage /> }` — replace Showcase with DiscoverPage as default route.
         - `{ path: 'trending', element: <TrendingPage /> }`
         - `{ path: 'dinner-time', element: <DinnerTimePage /> }`
         - `{ path: 'free-movies', element: <FreeMoviesPage /> }`
       - Keep Showcase available at `/showcase` for design system verification (don't delete it).
       - Import all page components from `@/pages/*`.

    3. **TabBar** (`src/components/layout/TabBar.tsx`):
       - Fixed bottom navigation bar (`fixed bottom-0 left-0 right-0 z-50`).
       - Clay surface background with shadow-sm (elevated from content).
       - 4 tabs in a flex row, evenly spaced:
         - Compass icon + "Discover" — links to `/`
         - TrendingUp icon + "Trending" — links to `/trending`
         - UtensilsCrossed icon + "Dinner" — links to `/dinner-time`
         - Film icon + "Free" — links to `/free-movies`
       - Uses `NavLink` from react-router for active state detection.
       - Active tab: `text-accent` color + filled icon variant. Inactive: `text-clay-text-muted` + outlined.
       - Each tab: flex-col items-center, icon 20px, label text-xs font-medium.
       - Height: h-16 (matching navbar height for symmetry).
       - Safe area padding: `pb-[env(safe-area-inset-bottom)]` for iOS home indicator.

    4. **Update Navbar** (`src/components/layout/Navbar.tsx`):
       - Add Search icon (Lucide Search) button between the app title and theme controls.
       - On click: Toggle `searchOpen` local state to `true`.
       - Import and render `<SearchModal isOpen={searchOpen} onClose={() => setSearchOpen(false)} />` from Plan 03.
       - Search icon: MetalButton ghost variant, compact, with `aria-label="Search movies"`.

    5. **Update App.tsx** — Add TabBar and ToastProvider:
       - Import `TabBar` from `@/components/layout/TabBar`.
       - Import `ToastProvider` from `@/components/shared/Toast`.
       - Render `<TabBar />` after `<AppShell>` content (but inside the non-splash conditional).
       - Render `<ToastProvider />` at the app root level so toasts appear on all pages.
       - Add bottom padding to the main content area (`pb-20`) so content isn't hidden behind the fixed TabBar.

    6. **Run `useMigration` hook** — Ensure it's called in App.tsx on mount for legacy data migration. Check if it's already there; if not, add `useMigration()` call in App component.
  </action>
  <verify>
    - `npm run build` succeeds with no TypeScript errors
    - `grep -r "DiscoverPage\|TrendingPage\|DinnerTimePage\|FreeMoviesPage" src/main.tsx` confirms all routes
    - `grep -r "NavLink" src/components/layout/TabBar.tsx` confirms router navigation
    - `grep -r "SearchModal" src/components/layout/Navbar.tsx` confirms search integration
    - `grep -r "ToastProvider\|TabBar" src/App.tsx` confirms integration
    - `grep -r "safe-area-inset-bottom" src/components/layout/TabBar.tsx` confirms iOS safe area
    - `grep -r "Skip to main content" src/components/layout/AppShell.tsx` confirms skip nav link in AppShell
  </verify>
  <done>
    All page routes configured in main.tsx. Skip nav link added to AppShell as first focusable element for all pages. TabBar provides bottom navigation to all 4 modes. Navbar has search icon opening SearchModal. Toast provider renders at app root. Content has bottom padding for TabBar clearance. Legacy migration runs on mount.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify complete Phase 3 feature set end-to-end</name>
  <files>src/App.tsx</files>
  <action>
    Human verification checkpoint. What was built:
    Complete Phase 3 feature set: Discovery page with cinematic hero + interactions, Onboarding wizard, Search with voice + advanced filters, Trending horizontal scroll, Dinner Time mode, Free YouTube Movies, Tab navigation, Toast notifications, and Accessibility basics (skip nav, ARIA labels, focus rings, screen reader announcements).

    Steps to verify:
    1. Start dev server: `npm run dev` (should already be running at http://localhost:5173/)
    2. **First visit**: Onboarding wizard should appear asking to select providers and genres. Test selecting providers, selecting a genre, clicking "Get Started". Also test "Skip" button.
    3. **Discovery**: After onboarding, a movie should auto-load with full-bleed backdrop, poster, title, year, runtime, genres, ratings, streaming providers, and trailer link. Test "Next" button for new movie. Test "Love it" to see similar movies appear. Test "Watched" and "Not Interested" buttons (should show toast and load next).
    4. **Deep link**: Navigate to `http://localhost:5173/#/?movie=550` (Fight Club) — should load that specific movie.
    5. **Search**: Click search icon in navbar. Type a movie name — results should appear after 300ms. Test voice search button (Chrome/Edge only). Expand advanced filters, test dual-range sliders, genre selection, filter presets. Click a search result — should load on discovery page.
    6. **Trending tab**: Tap "Trending" in bottom tab bar. Should see horizontal scroll of Now Playing movies. Tap one to view details.
    7. **Dinner Time tab**: Tap "Dinner" in bottom tab bar. Select Netflix/Prime/Disney+. Should show family-friendly movie. Test "Watch on [Service]" button, "Great Pick" and "Not This One" buttons.
    8. **Free Movies tab**: Tap "Free" in bottom tab bar. Should show a random free movie with YouTube link. Test "Watch on YouTube" and "Next Suggestion".
    9. **Accessibility**: Tab through the page — all interactive elements should have visible focus rings. Check for skip nav link at top (visible on focus).
    10. **Persistence**: Refresh the page — preferences should be preserved, onboarding should not re-appear.
  </action>
  <verify>User confirms all 10 verification steps pass by typing "approved"</verify>
  <done>All Phase 3 features work end-to-end: discovery, search, trending, dinner time, free movies, onboarding, navigation, toast, accessibility. User has approved.</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds with zero errors
- All 4 tabs navigate correctly between pages
- Search modal opens from navbar and closes on Escape/outside click
- Toast notifications appear for Love/Watched/Not Interested actions
- Deep link ?movie=ID loads correct movie
- Onboarding appears on first visit, not on subsequent visits
- All pages handle loading, error, and empty states gracefully
</verification>

<success_criteria>
- Complete navigation between all 5 sections (Discover, Trending, Dinner Time, Free Movies, Search)
- All 25+ features from the vanilla JS app are functional in the React app
- User can complete the full core loop: discover movie -> view details -> interact -> discover next
- Preferences persist and apply to discovery
- No console errors during normal usage
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-features/03-05-SUMMARY.md`
</output>
